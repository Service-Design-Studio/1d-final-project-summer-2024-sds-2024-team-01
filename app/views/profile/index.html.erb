<body>
  <div class="container content">
    <div class="card mb-0 custom-card_profile header-card_profile">
      <div class="card-body header-container_profile">
        <!-- Profile picture container -->
        <div class="profile-picture-container">
          <div class="profile-picture"></div>
        </div>
        <!-- Profile info container -->
        <div class="profile-info-container">
          <!-- Profile name -->
          <h5><%= @profile.name %></h5>
          <!-- Star ratings -->
          <p class="mb-1 stars_user_profile">
            <% 5.times do |i| %>
              <i class="fas fa-star <%= 'checked' if @average_rating && i < @average_rating.to_i %>"></i>
            <% end %>
            (<%= @reviews_received.count %>)
          </p>
          <p>Trusted user</p>
        </div>
      </div>
    </div>
    <div class="card mb-0 custom-card_profile body-card_profile">
      <div class="card-body body-container_profile">
        <div class="follow-btn-profile">
          <button type="submit" class="btn follow-btn-profile">Edit profile</button>
        </div>
        <div class="options-icon-follow">
          <i class="fas fa-ellipsis-h"></i>
        </div>
        <!-- Tabs container -->
        <div class="tabs-container">
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link active" id="requests-tab" data-toggle="tab" href="#requests" role="tab" aria-controls="requests" aria-selected="true">Requests</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</a>
            </li>
          </ul>
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="requests" role="tabpanel" aria-labelledby="requests-tab">
              <!-- Content for Requests -->
              <div class="requests-grid">
                <% @requests.each do |request| %>
                  <div class="request-item">
                    <div class="request-content">
                      <a href="<%= request_path(request) %>">
                        <div class="request-square">
                          <% if request.thumbnail.attached? %> 
                          <img src="<%= image_url(request.thumbnail) %>" class="card-img-top" alt="<%= request.title %>"/> 
                          <% end %> 
                          <div class="request-popup">
                            <p> Number of slots available (TBI) </p>
                          </div>
                        </div>
                      </a>
                      <p class="request-name"><%= request.title %></p>
                      <div class="availability-indicator_profile_requests"><%= request.status %></div>
                      <div class="options-icon-requests">
                        <i class="fas fa-ellipsis-h"></i>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
              <!-- Content for Reviews -->
              <div class="review-summary">
                <h2><%= @average_rating.nil? ? '0.00' : @average_rating.round(2) %></h2>
                <p class="stars_user_profile">
                  <% 5.times do |i| %>
                    <i class="fas fa-star <%= 'checked' if @average_rating && i < @average_rating.to_i %>"></i>
                  <% end %>
                  (<%= @reviews_received.count %> Reviews)
                </p>
              </div>
              <div class="review-filters">
                <button class="btn btn-outline-dark">All</button>
                <button class="btn btn-outline-dark">From Volunteers</button>
                <button class="btn btn-outline-dark">From Requesters</button>
                <div class="sort-by">
                  <label for="sort-reviews">Sort by</label>
                  <select id="sort-reviews" class="form-control">
                    <option>Highest ratings</option>
                    <option>Lowest ratings</option>
                    <option>Recent</option>
                  </select>
                </div>
              </div>
              <% if @reviews_received.any? %>
                <% @reviews_received.each do |review| %>
                  <div class="review-item card mb-3">
                    <div class="card-body">
                      <div class="d-flex justify-content-between">
                        <div>
                          <h5 class="card-title"><%= review.review_by.name %></h5>
                          <p class="card-text"><%= review.review_content %></p>
                        </div>
                        <div>
                          <p class="stars_user_profile">
                            <% 5.times do |i| %>
                              <i class="fas fa-star <%= 'checked' if i < review.rating %>"></i>
                            <% end %>
                          </p>
                          <small class="text-muted"><%= time_ago_in_words(review.created_at) %> ago</small>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p>No reviews yet.</p>
              <% end %>
            </div>
          </div>
        </div>
        <!--Profile user description container-->
        <div class="card mb-0 profile-user_description_container">
          <p>This holds the user written description.</p>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
